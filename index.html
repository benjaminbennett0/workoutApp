<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade Workout Timer</title>
    <style>
        :root { --primary: #1DB954; --bg: #000; --card: #111; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 40px; border-radius: 30px; border: 2px solid var(--primary); text-align: center; width: 320px; box-shadow: 0 0 20px rgba(29, 185, 84, 0.2); }
        .timer-display { font-size: 5rem; font-weight: bold; margin: 20px 0; font-variant-numeric: tabular-nums; color: var(--primary); text-shadow: 0 0 10px rgba(29, 185, 84, 0.5); }
        .label { text-transform: uppercase; letter-spacing: 2px; color: #888; font-size: 0.9rem; }
        .controls { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        button { padding: 20px; border-radius: 15px; border: none; font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        #startBtn { background: var(--primary); color: #000; }
        #startBtn:active { transform: scale(0.95); }
        #resetBtn { background: #333; color: #fff; }
        .status { margin-top: 15px; height: 20px; font-size: 0.8rem; color: #555; }
    </style>
</head>
<body>

    <div class="container">
        <div class="label" id="phaseLabel">Ready?</div>
        <div class="timer-display" id="display">05:00</div>
        
        <div class="controls">
            <button id="startBtn" onclick="toggleTimer()">START WORKOUT</button>
            <button id="resetBtn" onclick="resetTimer()">RESET</button>
        </div>
        <div class="status" id="status">Audio Engine: Standby</div>
    </div>

<script>
    // --- AUDIO CALIBRATION (V1.5.6) ---
    const BEEP_PEAKS = [220, 438, 874, 1743, 2662];
    const GO_PEAKS = [438, 874, 1743, 2663, 3490, 5328];
    const VOL_MIX = [1.0, 0.8, 0.5, 0.4, 0.3, 0.4]; // Based on your slider choices
    const GHOST_VOL = 0.10;
    const GO_FADE_START = 0.9;
    const GO_FADE_TO = 0.5;

    let audioCtx;
    let timerInterval;
    let timeLeft = 300; // 5 minutes
    let isRunning = false;

    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            document.getElementById('status').innerText = "Audio Engine: Active";
        }
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playBuzzer(isFinal = false, isGhost = false, customDuration = 4.0) {
        initAudio();
        const now = audioCtx.currentTime;
        const duration = isFinal ? 1.0 : 0.5;
        const peaks = isFinal ? GO_PEAKS : BEEP_PEAKS;

        const masterOut = audioCtx.createGain();
        masterOut.gain.setValueAtTime(0.2, now);
        masterOut.connect(audioCtx.destination);

        peaks.forEach((freq, index) => {
            const osc = audioCtx.createOscillator();
            const oscGain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, now);

            // Select volume from mix (Peak 6 is for GO extras)
            let peakVol = (isFinal && index >= 4) ? VOL_MIX[5] : VOL_MIX[index];

            if (isGhost) {
                oscGain.gain.setValueAtTime(0, now);
                oscGain.gain.linearRampToValueAtTime(peakVol * GHOST_VOL, now + 0.05);
                oscGain.gain.setValueAtTime(peakVol * GHOST_VOL, now + customDuration);
                oscGain.gain.setValueAtTime(0, now + customDuration + 0.001);
            } else if (isFinal) {
                oscGain.gain.setValueAtTime(peakVol, now);
                oscGain.gain.setValueAtTime(peakVol, now + GO_FADE_START);
                oscGain.gain.linearRampToValueAtTime(peakVol * GO_FADE_TO, now + duration);
                oscGain.gain.setValueAtTime(0, now + duration + 0.001);
            } else {
                oscGain.gain.setValueAtTime(peakVol, now);
                oscGain.gain.setValueAtTime(0, now + duration);
            }

            osc.connect(oscGain);
            oscGain.connect(masterOut);
            osc.start();
            osc.stop(now + (isGhost ? customDuration : duration) + 0.1);
        });
    }

    // --- TIMER LOGIC ---
    function runCountdown() {
        document.getElementById('phaseLabel').innerText = "Get Set...";
        playBuzzer(false, true, 4.0); // Start Ghost
        
        playBuzzer(false, false); // "3"
        setTimeout(() => playBuzzer(false, false), 1000); // "2"
        setTimeout(() => playBuzzer(false, false), 2000); // "1"
        setTimeout(() => {
            playBuzzer(true, false); // "GO"
            document.getElementById('phaseLabel').innerText = "GO!";
            startMainTimer();
        }, 3000);
    }

    function startMainTimer() {
        isRunning = true;
        document.getElementById('startBtn').innerText = "PAUSE";
        timerInterval = setInterval(() => {
            timeLeft--;
            updateDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('phaseLabel').innerText = "FINISH!";
            }
        }, 1000);
    }

    function updateDisplay() {
        const mins = Math.floor(timeLeft / 60);
        const secs = timeLeft % 60;
        document.getElementById('display').innerText = 
            `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function toggleTimer() {
        initAudio();
        if (isRunning) {
            clearInterval(timerInterval);
            isRunning = false;
            document.getElementById('startBtn').innerText = "RESUME";
        } else {
            if (timeLeft === 300) {
                runCountdown();
            } else {
                startMainTimer();
            }
        }
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timeLeft = 300;
        isRunning = false;
        updateDisplay();
        document.getElementById('startBtn').innerText = "START WORKOUT";
        document.getElementById('phaseLabel').innerText = "Ready?";
    }

    document.addEventListener('touchstart', initAudio, {once: true});
</script>
</body>
</html>
