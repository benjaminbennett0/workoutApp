<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dynamic Workout OS</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1DB954">

    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* Top Music Bar */
        #music-zone { height: 15vh; border-bottom: 2px solid #333; position: relative; display: flex; align-items: center; justify-content: center; }
        #progress-bar { position: absolute; bottom: 0; left: 0; height: 4px; background: #1DB954; width: 40%; }

        /* Main Workout Zone */
        #workout-zone {
            height: 85vh;
            display: flex;
            flex-direction: row; /* Side-by-side in landscape */
            align-items: center;
            justify-content: space-evenly;
        }
        
        .superset-box {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        #timer-container {
            width: 25vw;
            text-align: center;
            border-left: 2px solid #333;
            border-right: 2px solid #333;
        }
        
        #timer { font-size: 8vw; font-weight: bold; }
        .activity-label { font-size: 1.5vw; color: #1DB954; letter-spacing: 2px; }
        .exercise-name { font-size: 4vw; font-weight: bold; margin: 10px 0; }
        .exercise-stats { font-size: 3vw; color: #aaa; }

        /* Selection Screen */
        #selection-overlay { position: fixed; inset: 0; background: black; display: flex; gap: 20px; align-items: center; justify-content: center; z-index: 10; }
        .routine-btn { padding: 40px; font-size: 2rem; background: #222; border: 2px solid white; color: white; border-radius: 15px; }
    </style>
</head>
<body>

    <div id="selection-overlay">
        <button class="routine-btn" onclick="startRoutine('upper')">Upper Body</button>
        <button class="routine-btn" onclick="startRoutine('lower')">Lower Body</button>
    </div>

    <div id="music-zone" onclick="handleMusicTap(event)">
        <div id="song-display"><strong>Song Title</strong> - Artist Name</div>
        <div id="progress-bar"></div>
    </div>

    <div id="workout-zone" onclick="handleWorkoutTap(event)">
        <div class="superset-box" id="box-a">
            <div class="activity-label">EXERCISE A</div>
            <div class="exercise-name" id="name-a">Loading...</div>
            <div class="exercise-stats" id="stats-a">-- lbs x --</div>
        </div>
    
        <div id="timer-container">
            <div id="timer">00:00</div>
        </div>
    
        <div class="superset-box" id="box-b">
            <div class="activity-label">EXERCISE B</div>
            <div class="exercise-name" id="name-b">Loading...</div>
            <div class="exercise-stats" id="stats-b">-- lbs x --</div>
        </div>
    </div>

    <script>
        let isRunning = false;
        
        function handleWorkoutTap(e) {
            const isLeft = e.clientX < window.innerWidth / 2;
            if (isRunning) {
                if (isLeft) stopTimer();
                else nextActivity();
            } else {
                if (isLeft) prevActivity();
                else startTimer();
            }
        }

        function handleMusicTap(e) {
            const isLeft = e.clientX < window.innerWidth / 2;
            if (isLeft) console.log("Music: Back/Stop");
            else console.log("Music: Skip/Play");
        }

        function startTimer() { isRunning = true; document.getElementById('timer').style.color = 'white'; }
        function stopTimer() { isRunning = false; document.getElementById('timer').style.color = 'red'; }
        
        function startRoutine(type) {
            document.getElementById('selection-overlay').style.display = 'none';
            // Data fetch logic goes here
            console.log("Starting " + type);
        }

        function displayExercise() {
            // We now move by +2 to get the next pair
            const exA = workoutData[currentIndex];
            const exB = workoutData[currentIndex + 1];
        
            // Update Box A
            document.getElementById('name-a').innerText = exA[1].toUpperCase();
            document.getElementById('stats-a').innerText = `${exA[2]} x ${exA[3]}`;
        
            // Update Box B (Check if there is actually a second exercise)
            if (exB) {
                document.getElementById('name-b').innerText = exB[1].toUpperCase();
                document.getElementById('stats-b').innerText = `${exB[2]} x ${exB[3]}`;
                document.getElementById('box-b').style.opacity = "1";
            } else {
                document.getElementById('name-b').innerText = "FINISH";
                document.getElementById('stats-b').innerText = "";
                document.getElementById('box-b').style.opacity = "0.3";
            }
        
            document.getElementById('timer').innerText = "00:00";
            document.getElementById('timer').style.color = 'white';
        }
        
        function nextActivity() {
            // Jump by 2 for supersets
            if (currentIndex < workoutData.length - 2) {
                currentIndex += 2;
                displayExercise();
                stopTimer();
            } else {
                alert("Workout Complete!");
                location.reload();
            }
        }
        function prevActivity() { console.log("Prev"); }

        // IMPROVED SERVICE WORKER REGISTRATION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered'))
                    .catch(err => console.log('SW Failed', err));
            });
        }
    </script>
</body>
</html>

